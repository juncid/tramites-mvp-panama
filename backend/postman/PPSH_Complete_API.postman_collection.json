{
  "info": {
    "_postman_id": "ppsh-complete-api-2025",
    "name": "PPSH - API Completa",
    "description": "Colecci√≥n completa de todos los endpoints del m√≥dulo PPSH (Permiso Por razones de Seguridad Humanitaria) del Sistema de Tr√°mites Migratorios de Panam√°.\n\n**Incluye:**\n- Cat√°logos (Causas Humanitarias, Tipos de Documento, Estados)\n- Gesti√≥n de Solicitudes (CRUD completo)\n- Gesti√≥n de Documentos (Upload, Verificaci√≥n)\n- Gesti√≥n de Entrevistas\n- Comentarios y Seguimiento\n- Estad√≠sticas\n\n**Autor:** Sistema de Tr√°mites MVP Panam√°\n**Fecha:** 2025-10-21\n**Versi√≥n:** 1.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8000",
      "type": "string"
    },
    {
      "key": "api_prefix",
      "value": "/api/v1/ppsh",
      "type": "string"
    },
    {
      "key": "solicitud_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "documento_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "entrevista_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "comentario_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "num_expediente",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Cat√°logos",
      "item": [
        {
          "name": "Listar Causas Humanitarias",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response is array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "pm.test(\"Causas have required fields\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.length > 0) {",
                  "        var causa = jsonData[0];",
                  "        pm.expect(causa).to.have.property('cod_causa_humanitaria');",
                  "        pm.expect(causa).to.have.property('nombre_causa');",
                  "        pm.expect(causa).to.have.property('descripcion');",
                  "        pm.expect(causa).to.have.property('activo');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/catalogos/causas-humanitarias?activos_solo=true",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["catalogos", "causas-humanitarias"],
              "query": [
                {
                  "key": "activos_solo",
                  "value": "true"
                }
              ]
            },
            "description": "Obtiene todas las causas humanitarias activas disponibles para solicitudes PPSH"
          },
          "response": []
        },
        {
          "name": "Listar Tipos de Documento",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has document types\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    pm.expect(jsonData.length).to.be.above(0);",
                  "});",
                  "",
                  "pm.test(\"Types have required fields\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var tipo = jsonData[0];",
                  "    pm.expect(tipo).to.have.property('cod_tipo_doc');",
                  "    pm.expect(tipo).to.have.property('nombre_tipo');",
                  "    pm.expect(tipo).to.have.property('categoria');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/catalogos/tipos-documento?activos_solo=true",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["catalogos", "tipos-documento"],
              "query": [
                {
                  "key": "activos_solo",
                  "value": "true"
                }
              ]
            },
            "description": "Obtiene todos los tipos de documento requeridos para solicitudes PPSH"
          },
          "response": []
        },
        {
          "name": "Listar Estados del Proceso",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has estados\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "pm.test(\"Estados have required fields\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.length > 0) {",
                  "        var estado = jsonData[0];",
                  "        pm.expect(estado).to.have.property('cod_estado');",
                  "        pm.expect(estado).to.have.property('nombre_estado');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/catalogos/estados?activos_solo=true",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["catalogos", "estados"],
              "query": [
                {
                  "key": "activos_solo",
                  "value": "true"
                }
              ]
            },
            "description": "Obtiene todos los estados posibles del proceso PPSH"
          },
          "response": []
        }
      ],
      "description": "Endpoints de cat√°logos y datos maestros del sistema PPSH"
    },
    {
      "name": "2. Solicitudes - CRUD",
      "item": [
        {
          "name": "Crear Solicitud Individual",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Solicitud created with expediente\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id_solicitud');",
                  "    pm.expect(jsonData).to.have.property('num_expediente');",
                  "    pm.expect(jsonData.num_expediente).to.match(/^PPSH-\\d{4}-\\d+$/);",
                  "    ",
                  "    // Guardar IDs para otros tests",
                  "    pm.collectionVariables.set('solicitud_id', jsonData.id_solicitud);",
                  "    pm.collectionVariables.set('num_expediente', jsonData.num_expediente);",
                  "});",
                  "",
                  "pm.test(\"Solicitud has titular\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.solicitantes).to.be.an('array');",
                  "    pm.expect(jsonData.solicitantes.length).to.eql(1);",
                  "    pm.expect(jsonData.solicitantes[0].es_titular).to.eql(true);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tipo_solicitud\": \"INDIVIDUAL\",\n  \"cod_causa_humanitaria\": 1,\n  \"descripcion_caso\": \"Solicitante v√≠ctima de violencia de g√©nero en su pa√≠s de origen. Requiere protecci√≥n humanitaria urgente.\",\n  \"prioridad\": \"ALTA\",\n  \"cod_agencia\": \"02\",\n  \"observaciones_generales\": \"ACNUR como agencia referente. Caso de violencia de g√©nero.\",\n  \"solicitantes\": [\n    {\n      \"es_titular\": true,\n      \"tipo_documento\": \"CEDULA\",\n      \"num_documento\": \"V-18456789\",\n      \"pais_emisor\": \"VEN\",\n      \"primer_nombre\": \"Mar√≠a\",\n      \"segundo_nombre\": \"Fernanda\",\n      \"primer_apellido\": \"Garc√≠a\",\n      \"segundo_apellido\": \"L√≥pez\",\n      \"fecha_nacimiento\": \"1985-03-15\",\n      \"cod_sexo\": \"F\",\n      \"cod_nacionalidad\": \"VEN\",\n      \"cod_estado_civil\": \"S\",\n      \"email\": \"maria.garcia@example.com\",\n      \"telefono\": \"+507 6123-4567\",\n      \"direccion_panama\": \"Calle 50, Edificio Plaza, Apto 5B, Ciudad de Panam√°\",\n      \"observaciones\": \"No tiene representante legal\"\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes"]
            },
            "description": "Crea una solicitud PPSH individual con un solo solicitante"
          },
          "response": []
        },
        {
          "name": "Crear Solicitud Grupal",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Solicitud grupal has multiple solicitantes\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.tipo_solicitud).to.eql('GRUPAL');",
                  "    pm.expect(jsonData.solicitantes).to.be.an('array');",
                  "    pm.expect(jsonData.solicitantes.length).to.be.above(1);",
                  "});",
                  "",
                  "pm.test(\"Has one titular and dependientes\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    var titular = jsonData.solicitantes.filter(s => s.es_titular);",
                  "    var dependientes = jsonData.solicitantes.filter(s => !s.es_titular);",
                  "    ",
                  "    pm.expect(titular.length).to.eql(1);",
                  "    pm.expect(dependientes.length).to.be.above(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tipo_solicitud\": \"GRUPAL\",\n  \"cod_causa_humanitaria\": 2,\n  \"descripcion_caso\": \"Familia completa desplazada por conflicto armado. Padres e hijos menores requieren protecci√≥n.\",\n  \"prioridad\": \"ALTA\",\n  \"cod_agencia\": \"01\",\n  \"observaciones_generales\": \"Cruz Roja Internacional como agencia referente. Caso urgente.\",\n  \"solicitantes\": [\n    {\n      \"es_titular\": true,\n      \"tipo_documento\": \"CEDULA\",\n      \"num_documento\": \"001-200680-0001P\",\n      \"pais_emisor\": \"NIC\",\n      \"primer_nombre\": \"Carlos\",\n      \"segundo_nombre\": \"Alberto\",\n      \"primer_apellido\": \"Rodr√≠guez\",\n      \"segundo_apellido\": \"M√©ndez\",\n      \"fecha_nacimiento\": \"1980-06-20\",\n      \"cod_sexo\": \"M\",\n      \"cod_nacionalidad\": \"NIC\",\n      \"cod_estado_civil\": \"C\",\n      \"email\": \"carlos.rodriguez@example.com\",\n      \"telefono\": \"+507 6234-5678\",\n      \"direccion_panama\": \"V√≠a Brasil, Edificio Los Robles, Apto 12A\",\n      \"observaciones\": \"Tiene representante legal: Lic. Andrea Morales (+507 6345-6789)\"\n    },\n    {\n      \"es_titular\": false,\n      \"parentesco_titular\": \"CONYUGE\",\n      \"tipo_documento\": \"CEDULA\",\n      \"num_documento\": \"001-150982-0002M\",\n      \"pais_emisor\": \"NIC\",\n      \"primer_nombre\": \"Ana\",\n      \"segundo_nombre\": \"Luc√≠a\",\n      \"primer_apellido\": \"M√©ndez\",\n      \"segundo_apellido\": \"Torres\",\n      \"fecha_nacimiento\": \"1982-09-15\",\n      \"cod_sexo\": \"F\",\n      \"cod_nacionalidad\": \"NIC\",\n      \"cod_estado_civil\": \"C\",\n      \"email\": \"ana.mendez@example.com\",\n      \"telefono\": \"+507 6234-5678\",\n      \"direccion_panama\": \"V√≠a Brasil, Edificio Los Robles, Apto 12A\"\n    },\n    {\n      \"es_titular\": false,\n      \"parentesco_titular\": \"HIJO\",\n      \"tipo_documento\": \"CEDULA\",\n      \"num_documento\": \"001-100410-0003P\",\n      \"pais_emisor\": \"NIC\",\n      \"primer_nombre\": \"Carlos\",\n      \"segundo_nombre\": \"Andr√©s\",\n      \"primer_apellido\": \"Rodr√≠guez\",\n      \"segundo_apellido\": \"M√©ndez\",\n      \"fecha_nacimiento\": \"2010-04-10\",\n      \"cod_sexo\": \"M\",\n      \"cod_nacionalidad\": \"NIC\",\n      \"cod_estado_civil\": \"S\",\n      \"direccion_panama\": \"V√≠a Brasil, Edificio Los Robles, Apto 12A\"\n    },\n    {\n      \"es_titular\": false,\n      \"parentesco_titular\": \"HIJO\",\n      \"tipo_documento\": \"CEDULA\",\n      \"num_documento\": \"001-251115-0004M\",\n      \"pais_emisor\": \"NIC\",\n      \"primer_nombre\": \"Sof√≠a\",\n      \"segundo_nombre\": \"Valentina\",\n      \"primer_apellido\": \"Rodr√≠guez\",\n      \"segundo_apellido\": \"M√©ndez\",\n      \"fecha_nacimiento\": \"2015-11-25\",\n      \"cod_sexo\": \"F\",\n      \"cod_nacionalidad\": \"NIC\",\n      \"cod_estado_civil\": \"S\",\n      \"direccion_panama\": \"V√≠a Brasil, Edificio Los Robles, Apto 12A\"\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes"]
            },
            "description": "Crea una solicitud PPSH familiar con m√∫ltiples solicitantes (titular + dependientes)"
          },
          "response": []
        },
        {
          "name": "Listar Solicitudes - Sin Filtros",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has pagination data\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('total');",
                  "    pm.expect(jsonData).to.have.property('page');",
                  "    pm.expect(jsonData).to.have.property('page_size');",
                  "    pm.expect(jsonData).to.have.property('total_pages');",
                  "    pm.expect(jsonData).to.have.property('items');",
                  "});",
                  "",
                  "pm.test(\"Items are solicitudes\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.items).to.be.an('array');",
                  "    ",
                  "    if (jsonData.items.length > 0) {",
                  "        var solicitud = jsonData.items[0];",
                  "        pm.expect(solicitud).to.have.property('id_solicitud');",
                  "        pm.expect(solicitud).to.have.property('num_expediente');",
                  "        pm.expect(solicitud).to.have.property('estado_actual');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes?page=1&page_size=20",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "page_size",
                  "value": "20"
                }
              ]
            },
            "description": "Lista todas las solicitudes con paginaci√≥n b√°sica"
          },
          "response": []
        },
        {
          "name": "Listar Solicitudes - Con Filtros",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes?page=1&page_size=20&estado=EN_REVISION&prioridad=ALTA&fecha_desde=2025-01-01&buscar=Garc√≠a",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "page_size",
                  "value": "20"
                },
                {
                  "key": "estado",
                  "value": "EN_REVISION"
                },
                {
                  "key": "prioridad",
                  "value": "ALTA"
                },
                {
                  "key": "causa_humanitaria",
                  "value": "1",
                  "disabled": true
                },
                {
                  "key": "fecha_desde",
                  "value": "2025-01-01"
                },
                {
                  "key": "fecha_hasta",
                  "value": "2025-12-31",
                  "disabled": true
                },
                {
                  "key": "agencia",
                  "value": "ACNUR",
                  "disabled": true
                },
                {
                  "key": "asignado_a",
                  "value": "USR001",
                  "disabled": true
                },
                {
                  "key": "buscar",
                  "value": "Garc√≠a"
                }
              ]
            },
            "description": "Lista solicitudes aplicando m√∫ltiples filtros: estado, prioridad, fechas, b√∫squeda por texto"
          },
          "response": []
        },
        {
          "name": "Obtener Solicitud por ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Solicitud has complete data\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id_solicitud');",
                  "    pm.expect(jsonData).to.have.property('num_expediente');",
                  "    pm.expect(jsonData).to.have.property('solicitantes');",
                  "    pm.expect(jsonData).to.have.property('documentos');",
                  "    pm.expect(jsonData).to.have.property('entrevistas');",
                  "    pm.expect(jsonData).to.have.property('comentarios');",
                  "    pm.expect(jsonData).to.have.property('historial_estados');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}"]
            },
            "description": "Obtiene el detalle completo de una solicitud con todas sus relaciones"
          },
          "response": []
        },
        {
          "name": "Actualizar Solicitud",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Solicitud updated successfully\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.prioridad).to.eql('URGENTE');",
                  "    pm.expect(jsonData.descripcion_caso).to.include('ACTUALIZADO');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"prioridad\": \"URGENTE\",\n  \"descripcion_caso\": \"ACTUALIZADO: Situaci√≥n de riesgo inminente. Requiere atenci√≥n inmediata.\",\n  \"observaciones_generales\": \"Caso escalado por recomendaci√≥n de ACNUR. Se requiere respuesta prioritaria.\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}"]
            },
            "description": "Actualiza los datos de una solicitud existente. Campos actualizables: prioridad, descripcion_caso, observaciones_generales, fecha_limite_respuesta, requiere_atencion_especial, motivo_atencion_especial, cod_causa_humanitaria, user_id_asignado, fecha_asignacion, tipo_dictamen, detalle_dictamen, observaciones_dictamen"
          },
          "response": []
        }
      ],
      "description": "Operaciones CRUD completas sobre solicitudes PPSH"
    },
    {
      "name": "3. Gesti√≥n de Estado y Asignaci√≥n",
      "item": [
        {
          "name": "Asignar Solicitud a Funcionario",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Solicitud assigned\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.user_id_asignado).to.exist;",
                  "    pm.expect(jsonData.fecha_asignacion).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/asignar?user_id_asignado=FUNC001",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "asignar"],
              "query": [
                {
                  "key": "user_id_asignado",
                  "value": "FUNC001",
                  "description": "User ID del funcionario analista"
                }
              ]
            },
            "description": "Asigna una solicitud a un funcionario espec√≠fico. Requiere permisos de administrador."
          },
          "response": []
        },
        {
          "name": "Cambiar Estado - Pasar a Revisi√≥n",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Estado changed\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.estado_actual).to.eql('EN_REVISION');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado_nuevo\": \"EN_REVISION\",\n  \"observaciones\": \"Solicitud pasada a revisi√≥n por analista. Documentaci√≥n inicial completa.\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/cambiar-estado",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "cambiar-estado"]
            },
            "description": "Cambia el estado de una solicitud de RECIBIDO a EN_REVISION. Esto crea autom√°ticamente un registro en el historial de estados que puede consultarse con el endpoint GET /solicitudes/{id}/historial"
          },
          "response": []
        },
        {
          "name": "Cambiar Estado - Aprobado",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado_nuevo\": \"APROBADO\",\n  \"observaciones\": \"Solicitud aprobada despu√©s de revisi√≥n completa y entrevista satisfactoria.\",\n  \"es_dictamen\": true,\n  \"tipo_dictamen\": \"FAVORABLE\",\n  \"dictamen_detalle\": \"Cumple todos los requisitos establecidos. Se recomienda emisi√≥n de permiso por 2 a√±os.\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/cambiar-estado",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "cambiar-estado"]
            },
            "description": "Aprueba una solicitud con dictamen oficial. Cada cambio de estado crea un registro en el historial."
          },
          "response": []
        },
        {
          "name": "Cambiar Estado - Rechazado",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"estado_nuevo\": \"RECHAZADO\",\n  \"observaciones\": \"Solicitud rechazada por inconsistencias en documentaci√≥n.\",\n  \"es_dictamen\": true,\n  \"tipo_dictamen\": \"DESFAVORABLE\",\n  \"dictamen_detalle\": \"No se pudo verificar la autenticidad de los documentos presentados. Documentaci√≥n insuficiente para comprobar situaci√≥n de riesgo.\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/cambiar-estado",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "cambiar-estado"]
            },
            "description": "Rechaza una solicitud con justificaci√≥n. El dictamen queda registrado en el historial."
          },
          "response": []
        },
        {
          "name": "Obtener Historial de Estados",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Historial is array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "",
                  "if (jsonData.length === 0) {",
                  "    console.log('‚ÑπÔ∏è Historial vac√≠o - La solicitud nunca ha cambiado de estado');",
                  "    console.log('üí° Para ver el historial:');",
                  "    console.log('   1. Ejecuta el request \"Cambiar Estado - Pasar a Revisi√≥n\"');",
                  "    console.log('   2. Vuelve a ejecutar este request');",
                  "} else {",
                  "    console.log(`‚úÖ Historial tiene ${jsonData.length} cambio(s) de estado`);",
                  "    ",
                  "    pm.test(\"Historial entries have required fields\", function () {",
                  "        var entry = jsonData[0];",
                  "        pm.expect(entry).to.have.property('estado_anterior');",
                  "        pm.expect(entry).to.have.property('estado_nuevo');",
                  "        pm.expect(entry).to.have.property('user_id');",
                  "        pm.expect(entry).to.have.property('fecha_cambio');",
                  "        pm.expect(entry).to.have.property('observaciones');",
                  "    });",
                  "    ",
                  "    // Mostrar resumen del √∫ltimo cambio",
                  "    var ultimo = jsonData[0];",
                  "    console.log(`üìã √öltimo cambio: ${ultimo.estado_anterior} ‚Üí ${ultimo.estado_nuevo}`);",
                  "    console.log(`üë§ Usuario: ${ultimo.user_id}`);",
                  "    console.log(`üìÖ Fecha: ${ultimo.fecha_cambio}`);",
                  "    if (ultimo.dias_en_estado_anterior) {",
                  "        console.log(`‚è±Ô∏è D√≠as en estado anterior: ${ultimo.dias_en_estado_anterior}`);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/historial",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "historial"]
            },
            "description": "Obtiene el historial completo de cambios de estado de una solicitud.\n\n**NOTA:** Si devuelve un array vac√≠o [], significa que la solicitud nunca ha cambiado de estado (est√° en su estado inicial RECIBIDO). Para ver el historial:\n1. Primero ejecuta el request 'Cambiar Estado - Pasar a Revisi√≥n' usando el mismo {{solicitud_id}}\n2. Luego ejecuta este request nuevamente\n3. Ver√°s el registro del cambio RECIBIDO ‚Üí EN_REVISION con fecha, usuario, observaciones y d√≠as en estado anterior"
          },
          "response": []
        }
      ],
      "description": "Endpoints para gesti√≥n de estados y asignaci√≥n de solicitudes"
    },
    {
      "name": "4. Documentos",
      "item": [
        {
          "name": "Subir Documento - Pasaporte",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Documento uploaded\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id_documento');",
                  "    pm.expect(jsonData.estado_verificacion).to.eql('PENDIENTE');",
                  "    ",
                  "    // Guardar ID para verificaci√≥n",
                  "    pm.collectionVariables.set('documento_id', jsonData.id_documento);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "archivo",
                  "type": "file",
                  "src": "/C:/temp/pasaporte_muestra.pdf",
                  "description": "Archivo PDF del pasaporte"
                },
                {
                  "key": "cod_tipo_documento",
                  "value": "3",
                  "description": "3 = Pasaporte Notariado"
                },
                {
                  "key": "observaciones",
                  "value": "Pasaporte vigente hasta 2028. Todas las p√°ginas incluidas."
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/documentos",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "documentos"]
            },
            "description": "Sube un documento a una solicitud (usando tipo de cat√°logo)"
          },
          "response": []
        },
        {
          "name": "Subir Documento - Tipo Personalizado",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "archivo",
                  "type": "file",
                  "src": "/C:/temp/certificado_medico.pdf"
                },
                {
                  "key": "tipo_documento_texto",
                  "value": "Certificado M√©dico de Trauma Psicol√≥gico",
                  "description": "Tipo personalizado no en cat√°logo"
                },
                {
                  "key": "observaciones",
                  "value": "Certificado emitido por Hospital Santo Tom√°s, avalado por psic√≥loga cl√≠nica."
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/documentos",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "documentos"]
            },
            "description": "Sube un documento con tipo personalizado (no en cat√°logo)"
          },
          "response": []
        },
        {
          "name": "Verificar Documento - Aprobado",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Documento verificado\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.estado_verificacion).to.eql('VERIFICADO');",
                  "    pm.expect(jsonData.verificado_por).to.exist;",
                  "    pm.expect(jsonData.fecha_verificacion).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/documentos/{{documento_id}}/verificar?estado=VERIFICADO&observaciones=Documento v√°lido. Pasaporte vigente y todas las p√°ginas legibles.",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["documentos", "{{documento_id}}", "verificar"],
              "query": [
                {
                  "key": "estado",
                  "value": "VERIFICADO"
                },
                {
                  "key": "observaciones",
                  "value": "Documento v√°lido. Pasaporte vigente y todas las p√°ginas legibles."
                }
              ]
            },
            "description": "Marca un documento como verificado"
          },
          "response": []
        },
        {
          "name": "Verificar Documento - Rechazado",
          "request": {
            "method": "PATCH",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/documentos/{{documento_id}}/verificar?estado=RECHAZADO&observaciones=Documento ilegible. Por favor cargar una copia de mejor calidad.",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["documentos", "{{documento_id}}", "verificar"],
              "query": [
                {
                  "key": "estado",
                  "value": "RECHAZADO"
                },
                {
                  "key": "observaciones",
                  "value": "Documento ilegible. Por favor cargar una copia de mejor calidad."
                }
              ]
            },
            "description": "Rechaza un documento con observaciones"
          },
          "response": []
        }
      ],
      "description": "Gesti√≥n de documentos: upload y verificaci√≥n"
    },
    {
      "name": "5. Entrevistas",
      "item": [
        {
          "name": "Programar Entrevista",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Entrevista programada\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id_entrevista');",
                  "    pm.expect(jsonData.estado_entrevista).to.eql('PROGRAMADA');",
                  "    ",
                  "    pm.collectionVariables.set('entrevista_id', jsonData.id_entrevista);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fecha_programada\": \"2025-11-15T10:00:00\",\n  \"lugar\": \"Oficina de Migraci√≥n - Sala de Entrevistas 2\",\n  \"entrevistador_user_id\": \"ANALISTA001\",\n  \"observaciones\": \"Preparar expediente completo. Solicitante requiere int√©rprete de lenguaje de se√±as.\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/entrevistas",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "entrevistas"]
            },
            "description": "Programa una entrevista para una solicitud"
          },
          "response": []
        },
        {
          "name": "Programar Entrevista Virtual",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fecha_programada\": \"2025-11-20T14:00:00\",\n  \"lugar\": \"Videoconferencia\",\n  \"entrevistador_user_id\": \"ANALISTA002\",\n  \"observaciones\": \"Entrevista virtual programada por solicitud del abogado representante. Verificar conexi√≥n 15 minutos antes.\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/entrevistas",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "entrevistas"]
            },
            "description": "Programa una entrevista virtual"
          },
          "response": []
        },
        {
          "name": "Registrar Resultado de Entrevista - Favorable",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Entrevista realizada\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.estado_entrevista).to.eql('REALIZADA');",
                  "    pm.expect(jsonData.resultado).to.eql('FAVORABLE');",
                  "    pm.expect(jsonData.notas_entrevistador).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fecha_realizada\": \"2025-11-15T10:30:00\",\n  \"asistio\": true,\n  \"resultado\": \"FAVORABLE\",\n  \"observaciones\": \"Entrevista realizada satisfactoriamente. Solicitante respondi√≥ todas las preguntas de manera coherente y consistente con la documentaci√≥n presentada. Se confirma situaci√≥n de riesgo en pa√≠s de origen. Actitud colaborativa. Se recomienda APROBACI√ìN de la solicitud.\",\n  \"requiere_segunda_entrevista\": false\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/entrevistas/{{entrevista_id}}",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["entrevistas", "{{entrevista_id}}"]
            },
            "description": "Registra el resultado de una entrevista realizada con resultado favorable"
          },
          "response": []
        },
        {
          "name": "Registrar Resultado - Requiere Seguimiento",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fecha_realizada\": \"2025-11-20T14:15:00\",\n  \"asistio\": true,\n  \"resultado\": \"REQUIERE_SEGUIMIENTO\",\n  \"observaciones\": \"Entrevista realizada. Se detectaron algunas inconsistencias menores en las fechas declaradas que requieren verificaci√≥n adicional. Solicitante mostr√≥ nerviosismo pero informaci√≥n general es consistente. Se requiere segunda entrevista de seguimiento y verificaci√≥n de referencias adicionales.\",\n  \"requiere_segunda_entrevista\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/entrevistas/{{entrevista_id}}",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["entrevistas", "{{entrevista_id}}"]
            },
            "description": "Registra resultado que requiere seguimiento adicional"
          },
          "response": []
        }
      ],
      "description": "Gesti√≥n de entrevistas: programaci√≥n y registro de resultados"
    },
    {
      "name": "6. Comentarios",
      "item": [
        {
          "name": "Agregar Comentario Interno",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Comentario created\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id_comentario');",
                  "    pm.expect(jsonData.es_interno).to.eql(true);",
                  "    ",
                  "    pm.collectionVariables.set('comentario_id', jsonData.id_comentario);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"comentario\": \"Nota interna: Contact√© telef√≥nicamente al solicitante para confirmar fecha de entrevista. Confirm√≥ asistencia. Recordar preparar documentaci√≥n de casos similares para comparaci√≥n.\",\n  \"es_interno\": true,\n  \"tipo_comentario\": \"NOTA_ANALISTA\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/comentarios",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "comentarios"]
            },
            "description": "Agrega un comentario interno (solo visible para funcionarios)"
          },
          "response": []
        },
        {
          "name": "Agregar Comentario P√∫blico",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"comentario\": \"Estimado solicitante, hemos recibido su documentaci√≥n. La entrevista est√° programada para el 15 de noviembre a las 10:00 AM en nuestras oficinas. Por favor, llegar 15 minutos antes y traer documento de identidad original.\",\n  \"es_interno\": false,\n  \"tipo_comentario\": \"COMUNICACION_SOLICITANTE\",\n  \"es_notificacion\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/comentarios",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "comentarios"]
            },
            "description": "Agrega un comentario p√∫blico (visible para el solicitante)"
          },
          "response": []
        },
        {
          "name": "Listar Comentarios - Todos",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Returns comentarios array\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/comentarios?incluir_internos=true",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "comentarios"],
              "query": [
                {
                  "key": "incluir_internos",
                  "value": "true",
                  "description": "Incluir comentarios internos"
                }
              ]
            },
            "description": "Lista todos los comentarios (internos y p√∫blicos)"
          },
          "response": []
        },
        {
          "name": "Listar Comentarios - Solo P√∫blicos",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/solicitudes/{{solicitud_id}}/comentarios?incluir_internos=false",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["solicitudes", "{{solicitud_id}}", "comentarios"],
              "query": [
                {
                  "key": "incluir_internos",
                  "value": "false"
                }
              ]
            },
            "description": "Lista solo comentarios p√∫blicos (visibles para solicitante)"
          },
          "response": []
        }
      ],
      "description": "Gesti√≥n de comentarios y comunicaciones"
    },
    {
      "name": "7. Estad√≠sticas y Reportes",
      "item": [
        {
          "name": "Obtener Estad√≠sticas Generales",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Estad√≠sticas have required data\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('total_solicitudes');",
                  "    pm.expect(jsonData).to.have.property('solicitudes_por_estado');",
                  "    pm.expect(jsonData).to.have.property('solicitudes_por_prioridad');",
                  "    pm.expect(jsonData).to.have.property('tiempo_promedio_procesamiento');",
                  "});",
                  "",
                  "pm.test(\"Estado breakdown exists\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.solicitudes_por_estado).to.be.an('object');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/estadisticas",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["estadisticas"]
            },
            "description": "Obtiene estad√≠sticas generales del sistema PPSH: totales, distribuci√≥n por estado, tiempos promedio, etc."
          },
          "response": []
        }
      ],
      "description": "Endpoints de estad√≠sticas y reportes"
    },
    {
      "name": "8. Health Check",
      "item": [
        {
          "name": "Health Check PPSH Module",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Module is healthy\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('healthy');",
                  "    pm.expect(jsonData.module).to.eql('PPSH');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/health",
              "host": ["{{base_url}}{{api_prefix}}"],
              "path": ["health"]
            },
            "description": "Verifica el estado del m√≥dulo PPSH"
          },
          "response": []
        }
      ],
      "description": "Health check del m√≥dulo"
    }
  ]
}
