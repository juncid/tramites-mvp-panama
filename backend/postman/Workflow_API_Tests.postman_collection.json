{
	"info": {
		"_postman_id": "workflow-dynamic-api-2025",
		"name": "Sistema Workflow Dinámico - API",
		"description": "Colección completa de endpoints para el Sistema de Workflow Dinámico del Sistema de Trámites Migratorios de Panamá.\n\n**Funcionalidades:**\n- Gestión de Workflows (plantillas de procesos)\n- Gestión de Etapas y Preguntas\n- Gestión de Conexiones entre etapas\n- Ejecución de Instancias de workflows\n- Comentarios e Historial\n\n**Autor:** Sistema de Trámites MVP Panamá\n**Fecha:** 2025-10-20",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		},
		{
			"key": "api_prefix",
			"value": "/api/v1/workflow",
			"type": "string"
		},
		{
			"key": "workflow_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "etapa_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "pregunta_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "conexion_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "instancia_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "current_user",
			"value": "ADMIN",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "1. Gestión de Workflows",
			"item": [
				{
					"name": "Crear Workflow Simple",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has workflow_id\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.collectionVariables.set(\"workflow_id\", jsonData.id);",
									"});",
									"",
									"pm.test(\"Workflow code is correct\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.codigo).to.eql(\"PPSH_PRUEBA\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"codigo\": \"PPSH_PRUEBA\",\n  \"nombre\": \"Permiso de Protección de Seguridad Humanitaria - Prueba\",\n  \"descripcion\": \"Workflow de prueba para el proceso PPSH\",\n  \"version\": \"1.0\",\n  \"estado\": \"BORRADOR\",\n  \"categoria\": \"Migración\",\n  \"color_hex\": \"#0066CC\",\n  \"icono\": \"shield\",\n  \"requiere_autenticacion\": true,\n  \"es_publico\": false,\n  \"perfiles_creadores\": [\"CIUDADANO\", \"ABOGADO\"]\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/workflows",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["workflows"]
						},
						"description": "Crea un nuevo workflow simple sin etapas ni conexiones"
					},
					"response": []
				},
				{
					"name": "Crear Workflow Completo con Etapas",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Workflow created with stages\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.etapas).to.be.an('array');",
									"    pm.expect(jsonData.etapas.length).to.be.at.least(1);",
									"    pm.collectionVariables.set(\"workflow_id\", jsonData.id);",
									"    ",
									"    // Guardar IDs de etapas para otros tests",
									"    if (jsonData.etapas.length > 0) {",
									"        pm.collectionVariables.set(\"etapa_id\", jsonData.etapas[0].id);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"codigo\": \"FLUJO_COMPLETO\",\n  \"nombre\": \"Flujo Completo de Prueba\",\n  \"descripcion\": \"Workflow completo con etapas y preguntas\",\n  \"estado\": \"ACTIVO\",\n  \"categoria\": \"Pruebas\",\n  \"perfiles_creadores\": [\"ADMIN\"],\n  \"etapas\": [\n    {\n      \"codigo\": \"INICIO\",\n      \"nombre\": \"Inicio del Proceso\",\n      \"descripcion\": \"Etapa inicial de registro\",\n      \"tipo_etapa\": \"ETAPA\",\n      \"orden\": 1,\n      \"es_etapa_inicial\": true,\n      \"es_etapa_final\": false,\n      \"perfiles_permitidos\": [\"CIUDADANO\", \"ABOGADO\"],\n      \"titulo_formulario\": \"Datos Personales\",\n      \"bajada_formulario\": \"Por favor complete sus datos personales\",\n      \"preguntas\": [\n        {\n          \"codigo\": \"NOMBRE\",\n          \"pregunta\": \"¿Cuál es su nombre completo?\",\n          \"tipo_pregunta\": \"RESPUESTA_TEXTO\",\n          \"orden\": 1,\n          \"es_obligatoria\": true,\n          \"validacion_regex\": \"^[a-zA-ZáéíóúÁÉÍÓÚñÑ ]+$\",\n          \"mensaje_validacion\": \"Solo se permiten letras y espacios\",\n          \"placeholder\": \"Juan Pérez García\"\n        },\n        {\n          \"codigo\": \"EMAIL\",\n          \"pregunta\": \"¿Cuál es su correo electrónico?\",\n          \"tipo_pregunta\": \"RESPUESTA_TEXTO\",\n          \"orden\": 2,\n          \"es_obligatoria\": true,\n          \"validacion_regex\": \"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\\\.[a-zA-Z]{2,}$\",\n          \"mensaje_validacion\": \"Debe ser un correo electrónico válido\",\n          \"placeholder\": \"ejemplo@correo.com\"\n        },\n        {\n          \"codigo\": \"NACIONALIDAD\",\n          \"pregunta\": \"¿Cuál es su nacionalidad?\",\n          \"tipo_pregunta\": \"LISTA\",\n          \"orden\": 3,\n          \"es_obligatoria\": true,\n          \"opciones\": [\"Panameña\", \"Venezolana\", \"Colombiana\", \"Nicaragüense\", \"Otra\"]\n        }\n      ]\n    },\n    {\n      \"codigo\": \"DOCUMENTOS\",\n      \"nombre\": \"Carga de Documentos\",\n      \"descripcion\": \"Etapa de carga de documentos\",\n      \"tipo_etapa\": \"ETAPA\",\n      \"orden\": 2,\n      \"perfiles_permitidos\": [\"CIUDADANO\", \"ABOGADO\"],\n      \"titulo_formulario\": \"Documentos Requeridos\",\n      \"preguntas\": [\n        {\n          \"codigo\": \"PASAPORTE\",\n          \"pregunta\": \"Cargue copia de su pasaporte\",\n          \"tipo_pregunta\": \"CARGA_ARCHIVO\",\n          \"orden\": 1,\n          \"es_obligatoria\": true,\n          \"extensiones_permitidas\": [\".pdf\", \".jpg\", \".png\"],\n          \"tamano_maximo_mb\": 5,\n          \"texto_ayuda\": \"Debe ser una copia legible de todas las páginas\"\n        }\n      ]\n    },\n    {\n      \"codigo\": \"REVISION\",\n      \"nombre\": \"Revisión y Validación\",\n      \"descripcion\": \"Etapa de revisión por funcionario\",\n      \"tipo_etapa\": \"ETAPA\",\n      \"orden\": 3,\n      \"perfiles_permitidos\": [\"FUNCIONARIO\", \"ADMIN\"],\n      \"titulo_formulario\": \"Revisión de Solicitud\",\n      \"preguntas\": [\n        {\n          \"codigo\": \"APROBADO\",\n          \"pregunta\": \"¿Se aprueba la solicitud?\",\n          \"tipo_pregunta\": \"OPCIONES\",\n          \"orden\": 1,\n          \"es_obligatoria\": true,\n          \"opciones\": [\"SI\", \"NO\"],\n          \"permite_multiple\": false\n        }\n      ]\n    },\n    {\n      \"codigo\": \"FINALIZACION\",\n      \"nombre\": \"Finalización\",\n      \"descripcion\": \"Etapa final del proceso\",\n      \"tipo_etapa\": \"ETAPA\",\n      \"orden\": 4,\n      \"es_etapa_final\": true,\n      \"perfiles_permitidos\": [\"SISTEMA\"]\n    }\n  ],\n  \"conexiones\": [\n    {\n      \"etapa_origen_id\": 1,\n      \"etapa_destino_id\": 2,\n      \"nombre\": \"Ir a Documentos\",\n      \"es_predeterminada\": true\n    },\n    {\n      \"etapa_origen_id\": 2,\n      \"etapa_destino_id\": 3,\n      \"nombre\": \"Enviar a Revisión\",\n      \"es_predeterminada\": true\n    },\n    {\n      \"etapa_origen_id\": 3,\n      \"etapa_destino_id\": 4,\n      \"nombre\": \"Finalizar\",\n      \"condicion\": {\"pregunta\": \"APROBADO\", \"valor\": \"SI\"},\n      \"es_predeterminada\": true\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/workflows",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["workflows"]
						},
						"description": "Crea un workflow completo con etapas, preguntas y conexiones"
					},
					"response": []
				},
				{
					"name": "Listar Workflows",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/workflows?skip=0&limit=100&activo=true",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["workflows"],
							"query": [
								{
									"key": "skip",
									"value": "0"
								},
								{
									"key": "limit",
									"value": "100"
								},
								{
									"key": "estado",
									"value": "ACTIVO",
									"disabled": true
								},
								{
									"key": "categoria",
									"value": "Migración",
									"disabled": true
								},
								{
									"key": "activo",
									"value": "true"
								}
							]
						},
						"description": "Lista todos los workflows con filtros opcionales"
					},
					"response": []
				},
				{
					"name": "Obtener Workflow por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/workflows/{{workflow_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["workflows", "{{workflow_id}}"]
						},
						"description": "Obtiene los detalles completos de un workflow incluyendo etapas y preguntas"
					},
					"response": []
				},
				{
					"name": "Actualizar Workflow",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"Nombre Actualizado del Workflow\",\n  \"descripcion\": \"Descripción actualizada\",\n  \"estado\": \"ACTIVO\",\n  \"version\": \"1.1\"\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/workflows/{{workflow_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["workflows", "{{workflow_id}}"]
						},
						"description": "Actualiza la información de un workflow existente"
					},
					"response": []
				},
				{
					"name": "Eliminar Workflow",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/workflows/{{workflow_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["workflows", "{{workflow_id}}"]
						},
						"description": "Elimina (desactiva) un workflow"
					},
					"response": []
				}
			],
			"description": "Endpoints para crear y gestionar workflows (plantillas de procesos)"
		},
		{
			"name": "2. Gestión de Etapas",
			"item": [
				{
					"name": "Crear Etapa",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set(\"etapa_id\", jsonData.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"workflow_id\": {{workflow_id}},\n  \"codigo\": \"NUEVA_ETAPA\",\n  \"nombre\": \"Nueva Etapa\",\n  \"descripcion\": \"Descripción de la nueva etapa\",\n  \"tipo_etapa\": \"ETAPA\",\n  \"orden\": 5,\n  \"perfiles_permitidos\": [\"ADMIN\", \"FUNCIONARIO\"],\n  \"titulo_formulario\": \"Formulario de Nueva Etapa\",\n  \"requiere_validacion\": true,\n  \"tiempo_estimado_minutos\": 30\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/etapas",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["etapas"]
						},
						"description": "Crea una nueva etapa en un workflow existente"
					},
					"response": []
				},
				{
					"name": "Obtener Etapa por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/etapas/{{etapa_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["etapas", "{{etapa_id}}"]
						},
						"description": "Obtiene los detalles de una etapa incluyendo sus preguntas"
					},
					"response": []
				},
				{
					"name": "Actualizar Etapa",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"Etapa Actualizada\",\n  \"descripcion\": \"Descripción actualizada de la etapa\",\n  \"orden\": 2,\n  \"requiere_validacion\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/etapas/{{etapa_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["etapas", "{{etapa_id}}"]
						},
						"description": "Actualiza los datos de una etapa"
					},
					"response": []
				},
				{
					"name": "Eliminar Etapa",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/etapas/{{etapa_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["etapas", "{{etapa_id}}"]
						},
						"description": "Elimina (desactiva) una etapa"
					},
					"response": []
				}
			],
			"description": "Endpoints para gestionar etapas dentro de los workflows"
		},
		{
			"name": "3. Gestión de Preguntas",
			"item": [
				{
					"name": "Crear Pregunta",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set(\"pregunta_id\", jsonData.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"etapa_id\": {{etapa_id}},\n  \"codigo\": \"NUEVA_PREGUNTA\",\n  \"pregunta\": \"¿Cuál es tu nueva pregunta?\",\n  \"tipo_pregunta\": \"RESPUESTA_TEXTO\",\n  \"orden\": 10,\n  \"es_obligatoria\": true,\n  \"placeholder\": \"Escribe tu respuesta aquí\",\n  \"texto_ayuda\": \"Esta es una ayuda para la pregunta\"\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/preguntas",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["preguntas"]
						},
						"description": "Crea una nueva pregunta en una etapa"
					},
					"response": []
				},
				{
					"name": "Crear Pregunta con Opciones",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"etapa_id\": {{etapa_id}},\n  \"codigo\": \"PREGUNTA_OPCIONES\",\n  \"pregunta\": \"Seleccione una opción\",\n  \"tipo_pregunta\": \"OPCIONES\",\n  \"orden\": 11,\n  \"es_obligatoria\": true,\n  \"opciones\": [\"Opción A\", \"Opción B\", \"Opción C\"],\n  \"permite_multiple\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/preguntas",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["preguntas"]
						},
						"description": "Crea una pregunta con opciones de selección"
					},
					"response": []
				},
				{
					"name": "Crear Pregunta de Archivo",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"etapa_id\": {{etapa_id}},\n  \"codigo\": \"CARGA_DOC\",\n  \"pregunta\": \"Cargue su documento\",\n  \"tipo_pregunta\": \"CARGA_ARCHIVO\",\n  \"orden\": 12,\n  \"es_obligatoria\": true,\n  \"extensiones_permitidas\": [\".pdf\", \".doc\", \".docx\"],\n  \"tamano_maximo_mb\": 10,\n  \"requiere_ocr\": false,\n  \"texto_ayuda\": \"Formatos aceptados: PDF, DOC, DOCX. Tamaño máximo: 10MB\"\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/preguntas",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["preguntas"]
						},
						"description": "Crea una pregunta para carga de archivos"
					},
					"response": []
				},
				{
					"name": "Obtener Pregunta por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/preguntas/{{pregunta_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["preguntas", "{{pregunta_id}}"]
						},
						"description": "Obtiene los detalles de una pregunta"
					},
					"response": []
				},
				{
					"name": "Actualizar Pregunta",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"pregunta\": \"Pregunta actualizada\",\n  \"es_obligatoria\": false,\n  \"texto_ayuda\": \"Ayuda actualizada\"\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/preguntas/{{pregunta_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["preguntas", "{{pregunta_id}}"]
						},
						"description": "Actualiza una pregunta"
					},
					"response": []
				},
				{
					"name": "Eliminar Pregunta",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/preguntas/{{pregunta_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["preguntas", "{{pregunta_id}}"]
						},
						"description": "Elimina (desactiva) una pregunta"
					},
					"response": []
				}
			],
			"description": "Endpoints para gestionar preguntas dentro de las etapas"
		},
		{
			"name": "4. Gestión de Conexiones",
			"item": [
				{
					"name": "Crear Conexión",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"pm.collectionVariables.set(\"conexion_id\", jsonData.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"workflow_id\": {{workflow_id}},\n  \"etapa_origen_id\": 1,\n  \"etapa_destino_id\": 2,\n  \"nombre\": \"Avanzar\",\n  \"es_predeterminada\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/conexiones",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["conexiones"]
						},
						"description": "Crea una conexión entre dos etapas"
					},
					"response": []
				},
				{
					"name": "Crear Conexión con Condición",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"workflow_id\": {{workflow_id}},\n  \"etapa_origen_id\": 2,\n  \"etapa_destino_id\": 3,\n  \"nombre\": \"Si es aprobado\",\n  \"condicion\": {\n    \"pregunta\": \"APROBADO\",\n    \"operador\": \"==\",\n    \"valor\": \"SI\"\n  },\n  \"es_predeterminada\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/conexiones",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["conexiones"]
						},
						"description": "Crea una conexión con condiciones"
					},
					"response": []
				},
				{
					"name": "Obtener Conexión por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/conexiones/{{conexion_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["conexiones", "{{conexion_id}}"]
						},
						"description": "Obtiene los detalles de una conexión"
					},
					"response": []
				},
				{
					"name": "Actualizar Conexión",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre\": \"Conexión actualizada\",\n  \"condicion\": {\n    \"pregunta\": \"ESTADO\",\n    \"valor\": \"APROBADO\"\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/conexiones/{{conexion_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["conexiones", "{{conexion_id}}"]
						},
						"description": "Actualiza una conexión"
					},
					"response": []
				},
				{
					"name": "Eliminar Conexión",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/conexiones/{{conexion_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["conexiones", "{{conexion_id}}"]
						},
						"description": "Elimina una conexión"
					},
					"response": []
				}
			],
			"description": "Endpoints para gestionar conexiones entre etapas"
		},
		{
			"name": "5. Gestión de Instancias",
			"item": [
				{
					"name": "Crear Instancia",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Instance created with num_expediente\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('num_expediente');",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.collectionVariables.set(\"instancia_id\", jsonData.id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"workflow_id\": {{workflow_id}},\n  \"nombre_instancia\": \"Solicitud de Juan Pérez\",\n  \"prioridad\": \"NORMAL\",\n  \"metadata_adicional\": {\n    \"solicitante\": \"Juan Pérez\",\n    \"email\": \"juan.perez@example.com\",\n    \"telefono\": \"+507 6000-0000\"\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/instancias",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["instancias"]
						},
						"description": "Inicia una nueva instancia de un workflow"
					},
					"response": []
				},
				{
					"name": "Listar Instancias",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/instancias?skip=0&limit=50",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["instancias"],
							"query": [
								{
									"key": "skip",
									"value": "0"
								},
								{
									"key": "limit",
									"value": "50"
								},
								{
									"key": "workflow_id",
									"value": "{{workflow_id}}",
									"disabled": true
								},
								{
									"key": "estado",
									"value": "EN_PROGRESO",
									"disabled": true
								},
								{
									"key": "creado_por",
									"value": "USER001",
									"disabled": true
								}
							]
						},
						"description": "Lista las instancias de workflows con filtros"
					},
					"response": []
				},
				{
					"name": "Obtener Instancia por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/instancias/{{instancia_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["instancias", "{{instancia_id}}"]
						},
						"description": "Obtiene los detalles completos de una instancia con respuestas"
					},
					"response": []
				},
				{
					"name": "Actualizar Instancia",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nombre_instancia\": \"Solicitud Actualizada\",\n  \"prioridad\": \"ALTA\",\n  \"asignado_a_user_id\": \"FUNC001\",\n  \"metadata_adicional\": {\n    \"observaciones\": \"Requiere atención urgente\"\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/instancias/{{instancia_id}}",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["instancias", "{{instancia_id}}"]
						},
						"description": "Actualiza una instancia de workflow"
					},
					"response": []
				},
				{
					"name": "Transicionar a Siguiente Etapa",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"etapa_destino_id\": 2,\n  \"respuestas\": [\n    {\n      \"pregunta_id\": 1,\n      \"valor_texto\": \"Juan Pérez García\"\n    },\n    {\n      \"pregunta_id\": 2,\n      \"valor_texto\": \"juan.perez@example.com\"\n    },\n    {\n      \"pregunta_id\": 3,\n      \"valor_json\": {\"seleccion\": \"Panameña\"}\n    }\n  ],\n  \"comentario\": \"Formulario completado correctamente\"\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/instancias/{{instancia_id}}/transicion",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["instancias", "{{instancia_id}}", "transicion"]
						},
						"description": "Realiza una transición de una etapa a otra guardando respuestas"
					},
					"response": []
				}
			],
			"description": "Endpoints para ejecutar instancias de workflows"
		},
		{
			"name": "6. Comentarios e Historial",
			"item": [
				{
					"name": "Agregar Comentario",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"comentario\": \"Este es un comentario importante sobre la solicitud\",\n  \"es_interno\": true,\n  \"es_notificacion\": false,\n  \"archivos\": [\n    {\n      \"nombre\": \"nota.pdf\",\n      \"url\": \"/uploads/comentarios/nota.pdf\"\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/instancias/{{instancia_id}}/comentarios",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["instancias", "{{instancia_id}}", "comentarios"]
						},
						"description": "Agrega un comentario a una instancia"
					},
					"response": []
				},
				{
					"name": "Listar Comentarios",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/instancias/{{instancia_id}}/comentarios?incluir_internos=true",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["instancias", "{{instancia_id}}", "comentarios"],
							"query": [
								{
									"key": "incluir_internos",
									"value": "true"
								}
							]
						},
						"description": "Lista los comentarios de una instancia"
					},
					"response": []
				},
				{
					"name": "Obtener Historial",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}{{api_prefix}}/instancias/{{instancia_id}}/historial",
							"host": ["{{base_url}}{{api_prefix}}"],
							"path": ["instancias", "{{instancia_id}}", "historial"]
						},
						"description": "Obtiene el historial completo de cambios de una instancia"
					},
					"response": []
				}
			],
			"description": "Endpoints para comentarios e historial de instancias"
		}
	]
}
